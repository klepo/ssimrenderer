<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SSIMRenderer: ImageMetrics.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SSIMRenderer
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Statistical Shape and Intensity Models GPU-Accelerated Renderer Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ImageMetrics.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>This example renders two virtual X-Ray images, these images are then used to evaluate normalized mutual information and sum of squared differences image similarity metrics. Both metrics are implemented in CPU and OpenGL versions. For further details about setting the project file up, initialization of the application and rendering virtual X-Ray images, please have a look at the "SimpleStatismoModel" and "IntensityShapeModel" examples.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;QApplication&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;QDebug&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ssimrenderer_8h.html">ssimrenderer.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a name="a0"></a><a class="code" href="_image_metrics_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <span class="comment">// Initialization of Qt-based application, QCoreApplication is not sufficient.</span></div><div class="line">    QApplication a(argc, argv);</div><div class="line">    Q_UNUSED(a);</div><div class="line"></div><div class="line">    <span class="comment">// Initialization of the offscreen renderer.</span></div><div class="line">    <a name="_a1"></a><a class="code" href="class_s_s_i_m_renderer_1_1_offscreen_renderer.html">SSIMRenderer::OffscreenRenderer</a> *renderer = <span class="keyword">new</span> <a class="code" href="class_s_s_i_m_renderer_1_1_offscreen_renderer.html">SSIMRenderer::OffscreenRenderer</a>(1024, 1024);</div><div class="line"></div><div class="line">    <span class="comment">// Initialization of CPU and OpenGL versions of the NMI metric.</span></div><div class="line">    <span class="comment">// The image from the renderer will be used as one of the inputs for the metric evaluation.</span></div><div class="line">    <a name="_a2"></a><a class="code" href="class_s_s_i_m_renderer_1_1_n_m_i_computing_c_p_u.html">SSIMRenderer::NMIComputingCPU</a>    *nmiCPU    = <span class="keyword">new</span> <a class="code" href="class_s_s_i_m_renderer_1_1_n_m_i_computing_c_p_u.html">SSIMRenderer::NMIComputingCPU</a>(renderer);</div><div class="line">    <a name="_a3"></a><a class="code" href="class_s_s_i_m_renderer_1_1_n_m_i_computing_open_g_l.html">SSIMRenderer::NMIComputingOpenGL</a> *nmiOpenGL = <span class="keyword">new</span> <a class="code" href="class_s_s_i_m_renderer_1_1_n_m_i_computing_open_g_l.html">SSIMRenderer::NMIComputingOpenGL</a>(renderer);</div><div class="line"></div><div class="line">    <span class="comment">// Initialization of CPU and OpenGL versions of the SSD metric.</span></div><div class="line">    <a name="_a4"></a><a class="code" href="class_s_s_i_m_renderer_1_1_s_s_d_computing_c_p_u.html">SSIMRenderer::SSDComputingCPU</a>    *ssdCPU    = <span class="keyword">new</span> <a class="code" href="class_s_s_i_m_renderer_1_1_s_s_d_computing_c_p_u.html">SSIMRenderer::SSDComputingCPU</a>(renderer);</div><div class="line">    <a name="_a5"></a><a class="code" href="class_s_s_i_m_renderer_1_1_s_s_d_computing_open_g_l.html">SSIMRenderer::SSDComputingOpenGL</a> *ssdOpenGL = <span class="keyword">new</span> <a class="code" href="class_s_s_i_m_renderer_1_1_s_s_d_computing_open_g_l.html">SSIMRenderer::SSDComputingOpenGL</a>(renderer);</div><div class="line"></div><div class="line">    <span class="comment">// Input files for the shape model.</span></div><div class="line">    <a name="_a6"></a><a class="code" href="class_s_s_i_m_renderer_1_1_lm6_mesh_file.html">SSIMRenderer::Lm6MeshFile</a> *meshFile = 0;</div><div class="line">    <a name="_a7"></a><a class="code" href="class_s_s_i_m_renderer_1_1_mat_statistical_data_file.html">SSIMRenderer::MatStatisticalDataFile</a> *shapeFile   = 0;</div><div class="line">    <a class="code" href="class_s_s_i_m_renderer_1_1_mat_statistical_data_file.html">SSIMRenderer::MatStatisticalDataFile</a> *densityFile = 0;</div><div class="line"></div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">        meshFile    = <span class="keyword">new</span> <a class="code" href="class_s_s_i_m_renderer_1_1_lm6_mesh_file.html">SSIMRenderer::Lm6MeshFile</a>(DATA_PATH <span class="stringliteral">&quot;/model.mesh&quot;</span>);</div><div class="line">        shapeFile   = <span class="keyword">new</span> <a class="code" href="class_s_s_i_m_renderer_1_1_mat_statistical_data_file.html">SSIMRenderer::MatStatisticalDataFile</a>(DATA_PATH <span class="stringliteral">&quot;/shape.mat&quot;</span>);</div><div class="line">        densityFile = <span class="keyword">new</span> <a class="code" href="class_s_s_i_m_renderer_1_1_mat_statistical_data_file.html">SSIMRenderer::MatStatisticalDataFile</a>(DATA_PATH <span class="stringliteral">&quot;/density.b3.mat&quot;</span>);</div><div class="line"></div><div class="line">    } <span class="keywordflow">catch</span> (std::exception &amp;e) {</div><div class="line">        <span class="comment">// Wrong file</span></div><div class="line">        qFatal(e.what());</div><div class="line">        exit(EXIT_FAILURE);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Sets the tetrahedral and statistical models to the renderer.</span></div><div class="line">    renderer-&gt;<a name="a8"></a><a class="code" href="class_s_s_i_m_renderer_1_1_offscreen_renderer.html#a671f9488620b888ec548883ee795b8d9">setMesh</a>(meshFile);</div><div class="line">    renderer-&gt;<a name="a9"></a><a class="code" href="class_s_s_i_m_renderer_1_1_offscreen_renderer.html#a535823451ea845503d2e277b47525722">setVertices</a>(shapeFile);</div><div class="line">    renderer-&gt;<a name="a10"></a><a class="code" href="class_s_s_i_m_renderer_1_1_offscreen_renderer.html#a0ff9cedc4539977211957a00da36e751">setCoefficients</a>(densityFile);</div><div class="line"></div><div class="line">    <span class="comment">// Setting up the renderer to render the virtual X-Ray images.</span></div><div class="line">    renderer-&gt;<a name="a11"></a><a class="code" href="class_s_s_i_m_renderer_1_1_offscreen_renderer.html#a996774c957af4f5f022f5d5f33acfc52">enableSilhouettes</a>(<span class="keyword">false</span>);</div><div class="line">    renderer-&gt;<a name="a12"></a><a class="code" href="class_s_s_i_m_renderer_1_1_offscreen_renderer.html#a404234615f5773f37f00a2ab9eb1c76d">enableDensity</a>(<span class="keyword">true</span>);</div><div class="line">    renderer-&gt;<a name="a13"></a><a class="code" href="class_s_s_i_m_renderer_1_1_offscreen_renderer.html#ae859ec2b93d7b7f85e2182eb8ee45b15">enablePyramid</a>(<span class="keyword">true</span>);</div><div class="line">    renderer-&gt;<a name="a14"></a><a class="code" href="class_s_s_i_m_renderer_1_1_offscreen_renderer.html#ac126d47257d2f69a2aeaef90f30ce0d5">enablePolygonal</a>(<span class="keyword">false</span>);</div><div class="line"></div><div class="line">    <span class="comment">// Initialization of the perspective.</span></div><div class="line">    QVector3D eye(        102.8380004f,  551.2176983f, -430.5f);</div><div class="line">    QVector3D leftTop(   -408.6619996f, -448.7823017f, -942.f);</div><div class="line">    QVector3D leftBottom(-408.6619996f, -448.7823017f,   81.f);</div><div class="line">    QVector3D rightTop(   614.3380004f, -448.7823017f, -942.f);</div><div class="line">    QVector3D rightBottom(614.3380004f, -448.7823017f,   81.f);</div><div class="line">    <a name="_a15"></a><a class="code" href="class_s_s_i_m_renderer_1_1_pyramid.html">SSIMRenderer::Pyramid</a> pyramid(leftTop, leftBottom, rightTop, rightBottom, eye);</div><div class="line"></div><div class="line">    <span class="comment">// Sets the perspective to the renderer.</span></div><div class="line">    renderer-&gt;<a name="a16"></a><a class="code" href="class_s_s_i_m_renderer_1_1_main_renderer.html#a4c3a427647216e29441d53f0c84e1977">setPerspective</a>(pyramid);</div><div class="line"></div><div class="line">    <span class="comment">// Sets some particular shape parameters.</span></div><div class="line">    shapeFile-&gt;<a name="a17"></a><a class="code" href="class_s_s_i_m_renderer_1_1_statistical_data.html#ae67d7a880be195d7e45f4c0a40ee0536">updatePcsMatrix</a>(0,  500);</div><div class="line">    shapeFile-&gt;<a class="code" href="class_s_s_i_m_renderer_1_1_statistical_data.html#ae67d7a880be195d7e45f4c0a40ee0536">updatePcsMatrix</a>(1, -500);</div><div class="line">    shapeFile-&gt;<a class="code" href="class_s_s_i_m_renderer_1_1_statistical_data.html#ae67d7a880be195d7e45f4c0a40ee0536">updatePcsMatrix</a>(2,  250);</div><div class="line"></div><div class="line">    renderer-&gt;<a name="a18"></a><a class="code" href="class_s_s_i_m_renderer_1_1_offscreen_renderer.html#a3a07a4cd221c4d269b659fa7661c780f">updateVertices</a>(shapeFile);</div><div class="line"></div><div class="line">    <span class="comment">// Sets pose of the shape model.</span></div><div class="line">    renderer-&gt;<a name="a19"></a><a class="code" href="class_s_s_i_m_renderer_1_1_main_renderer.html#a327d040d09538dd27d818d624efe4eb3">setRotation</a>(1.4756f, 3.0457f, 30.784f);</div><div class="line">    renderer-&gt;<a name="a20"></a><a class="code" href="class_s_s_i_m_renderer_1_1_main_renderer.html#a2befb45d965bd62396f6d6f8e73f0b4b">setTranslation</a>(111.81f, 47.057f, -437.07f);</div><div class="line"></div><div class="line">    renderer-&gt;<a name="a21"></a><a class="code" href="class_s_s_i_m_renderer_1_1_open_g_l_wrapper.html#a2bc73ded7650da546f699260e6d18a63">renderNow</a>();</div><div class="line"></div><div class="line">    <span class="comment">// Sets some particular density parameters.</span></div><div class="line">    densityFile-&gt;<a class="code" href="class_s_s_i_m_renderer_1_1_statistical_data.html#ae67d7a880be195d7e45f4c0a40ee0536">updatePcsMatrix</a>(0, -98299);</div><div class="line">    densityFile-&gt;<a class="code" href="class_s_s_i_m_renderer_1_1_statistical_data.html#ae67d7a880be195d7e45f4c0a40ee0536">updatePcsMatrix</a>(1, 73185);</div><div class="line">    densityFile-&gt;<a class="code" href="class_s_s_i_m_renderer_1_1_statistical_data.html#ae67d7a880be195d7e45f4c0a40ee0536">updatePcsMatrix</a>(2, -300138);</div><div class="line">    densityFile-&gt;<a class="code" href="class_s_s_i_m_renderer_1_1_statistical_data.html#ae67d7a880be195d7e45f4c0a40ee0536">updatePcsMatrix</a>(3, -125250);</div><div class="line"></div><div class="line">    renderer-&gt;<a name="a22"></a><a class="code" href="class_s_s_i_m_renderer_1_1_offscreen_renderer.html#a2eebd78a3cc8dba596745dd407ce7156">updateCoefficients</a>(densityFile);</div><div class="line">    renderer-&gt;<a class="code" href="class_s_s_i_m_renderer_1_1_open_g_l_wrapper.html#a2bc73ded7650da546f699260e6d18a63">renderNow</a>();</div><div class="line"></div><div class="line">    <span class="comment">// Download the image from the renderer and use it also as the second</span></div><div class="line">    <span class="comment">// input to the metrics, so the metrics will be evaluated using two</span></div><div class="line">    <span class="comment">// exactly the same images.</span></div><div class="line"></div><div class="line">    QImage image = renderer-&gt;<a name="a23"></a><a class="code" href="class_s_s_i_m_renderer_1_1_main_renderer.html#a34f60a1dbc4969212772bceca7b29750">getRenderedImage</a>();</div><div class="line">    nmiCPU-&gt;<a name="a24"></a><a class="code" href="class_s_s_i_m_renderer_1_1_n_m_i_computing_c_p_u.html#a6bc527c690790c245419c9a6cba8f772">setInputImage</a>(image);</div><div class="line">    nmiOpenGL-&gt;<a name="a25"></a><a class="code" href="class_s_s_i_m_renderer_1_1_n_m_i_computing_open_g_l.html#a5791f452fa358c7ff20b61596360518e">setInputImage</a>(image);</div><div class="line">    ssdCPU-&gt;<a name="a26"></a><a class="code" href="class_s_s_i_m_renderer_1_1_s_s_d_computing_c_p_u.html#a0651d865075dbd80b1cf60fd7d002290">setInputImage</a>(image);</div><div class="line">    ssdOpenGL-&gt;<a name="a27"></a><a class="code" href="class_s_s_i_m_renderer_1_1_s_s_d_computing_open_g_l.html#ade7a564f5626266947651439e3f76df4">setInputImage</a>(image);</div><div class="line"></div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;&quot;</span>;</div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;Image similarity metrics evaluated on the same images &quot;</span>;</div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;------------------------------------------------------&quot;</span>;</div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;Normalized mutual information | CPU    |&quot;</span> &lt;&lt; nmiCPU-&gt;<a name="a28"></a><a class="code" href="class_s_s_i_m_renderer_1_1_metric_wrapper.html#a26436c29d794bf0e3263f1c20dc1dee0">compute</a>();</div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;Normalized mutual information | OpenGL |&quot;</span> &lt;&lt; nmiOpenGL-&gt;<a class="code" href="class_s_s_i_m_renderer_1_1_metric_wrapper.html#a26436c29d794bf0e3263f1c20dc1dee0">compute</a>();</div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;Sum of squared differences    | CPU    |&quot;</span> &lt;&lt; ssdCPU-&gt;<a class="code" href="class_s_s_i_m_renderer_1_1_metric_wrapper.html#a26436c29d794bf0e3263f1c20dc1dee0">compute</a>();</div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;Sum of squared differences    | OpenGL |&quot;</span> &lt;&lt; ssdOpenGL-&gt;<a class="code" href="class_s_s_i_m_renderer_1_1_metric_wrapper.html#a26436c29d794bf0e3263f1c20dc1dee0">compute</a>();</div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"></div><div class="line">    <span class="comment">// Slightly change the pose of the shape model and render new virtual X-Ray images,</span></div><div class="line">    <span class="comment">// so the first input to the metrics will be updated. Consequently, the metrics will</span></div><div class="line">    <span class="comment">// be evaluated on two different images this time.</span></div><div class="line"></div><div class="line">    renderer-&gt;<a class="code" href="class_s_s_i_m_renderer_1_1_main_renderer.html#a327d040d09538dd27d818d624efe4eb3">setRotation</a>(1.2756f, 3.4457f, 33.784f);</div><div class="line">    renderer-&gt;<a class="code" href="class_s_s_i_m_renderer_1_1_main_renderer.html#a2befb45d965bd62396f6d6f8e73f0b4b">setTranslation</a>(110.81f, 48.057f, -436.07f);</div><div class="line">    renderer-&gt;<a class="code" href="class_s_s_i_m_renderer_1_1_open_g_l_wrapper.html#a2bc73ded7650da546f699260e6d18a63">renderNow</a>();</div><div class="line"></div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;&quot;</span>;</div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;Image similarity metrics evaluated on different images &quot;</span>;</div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;------------------------------------------------------&quot;</span>;</div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;Normalized mutual information | CPU    |&quot;</span> &lt;&lt; nmiCPU-&gt;<a class="code" href="class_s_s_i_m_renderer_1_1_metric_wrapper.html#a26436c29d794bf0e3263f1c20dc1dee0">compute</a>();</div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;Normalized mutual information | OpenGL |&quot;</span> &lt;&lt; nmiOpenGL-&gt;<a class="code" href="class_s_s_i_m_renderer_1_1_metric_wrapper.html#a26436c29d794bf0e3263f1c20dc1dee0">compute</a>();</div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;Sum of squared differences    | CPU    |&quot;</span> &lt;&lt; ssdCPU-&gt;<a class="code" href="class_s_s_i_m_renderer_1_1_metric_wrapper.html#a26436c29d794bf0e3263f1c20dc1dee0">compute</a>();</div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;Sum of squared differences    | OpenGL |&quot;</span> &lt;&lt; ssdOpenGL-&gt;<a class="code" href="class_s_s_i_m_renderer_1_1_metric_wrapper.html#a26436c29d794bf0e3263f1c20dc1dee0">compute</a>();</div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"></div><div class="line">    <span class="keyword">delete</span> densityFile;</div><div class="line">    <span class="keyword">delete</span> shapeFile;</div><div class="line">    <span class="keyword">delete</span> meshFile;</div><div class="line">    <span class="keyword">delete</span> renderer;</div><div class="line">    <span class="keywordflow">return</span> EXIT_SUCCESS;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Feb 10 2017 12:07:23 for SSIMRenderer by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
